<!DOCTYPE html>
<html>
<head>
    <title>Search Results</title>
</head>
<body>
    <h1>Search Results for {{ majorSearchParam }} Classes Sorted by Course Number:</h1>
    {% for result in majorResults  %}
    <div>
        <h2>Class Number: {{ result['Class Number'] }}</h2>
        <p>Class Name: {{ result['Class Name'] }}</p>
        <p>Class Description: {{ result['Class Description'] }}</p>
        <p>Major: {{ result['Major'] }}</p>
        <p>We recommend you add this to year {{result['Year Number']}}.</p>
        <button class="btn btn-primary add-to-schedule" data-class="{{ result['Class Number'] }}">Add to Schedule</button>
    </div>
    {% endfor %}

    <h2>Search Results for {{ genEdSearchParam }} Non-Major Classes Sorted by Course Number:</h2>
    {% for result in genEdResults %}
    <div>
        <h2>Class Number: {{ result['Class Number'] }}</h2>
        <p>Class Name: {{ result['Class Name'] }}</p>
        <p>Class Description: {{ result['Class Description'] }}</p>
        <p>Major: {{ result['Major'] }}</p>
        <p>We recommend you add this to year {{result['Year Number']}}.</p>
        <button class="btn btn-primary add-to-schedule" data-class="{{ result['Class Number'] }}">Add to Schedule</button>
    </div>
    {% endfor %}

    <script>
        document.querySelectorAll('.add-to-schedule').forEach(button => {
            button.addEventListener('click', function() {
                var classDiv = this.parentElement;
                var classData = {
                    classNumber: extractTextAfterColon(classDiv.querySelector("h2").innerText),
                    className: extractTextAfterColon(classDiv.querySelectorAll("p")[0].innerText),
                    classDescription: extractTextAfterColon(classDiv.querySelectorAll("p")[1].innerText),
                    major: extractTextAfterColon(classDiv.querySelectorAll("p")[2].innerText),
                    yearNumber: extractTextAfterColon(classDiv.querySelectorAll("p")[3].innerText).replace('.', '')
                };
    
                // AJAX POST request to Flask
                fetch('/add-to-schedule', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(classData),
                })
                .then(response => response.json())
                .then(data => {
                    alert("Class added to schedule!");
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            });
        });
    
        function extractTextAfterColon(text) {
            return text.substring(text.indexOf(':') + 1).trim();
        }
    </script>
    
</body>
</html>